<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>NguyÃªn liá»‡u - Quáº£n lÃ½ báº¿p</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ¥¬ Quáº£n lÃ½ NguyÃªn liá»‡u</h1>
      <a href="index.html" class="btn btn-back">â† Vá» trang chá»§</a>

    <!-- Form thÃªm nguyÃªn liá»‡u -->
    <form id="addForm">
      <input type="text" id="tennl" placeholder="TÃªn nguyÃªn liá»‡u" required>
      <input type="text" id="donvi" placeholder="ÄÆ¡n vá»‹ (kg, lÃ­t, ...)" required>
      <input type="number" id="gia" placeholder="ÄÆ¡n giÃ¡ (VNÄ)" required>
      <button type="submit" class="btn btn-green">â• ThÃªm nguyÃªn liá»‡u</button>
    </form>

    <!-- Báº£ng danh sÃ¡ch -->
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>TÃªn nguyÃªn liá»‡u</th>
          <th>ÄÆ¡n vá»‹</th>
          <th>ÄÆ¡n giÃ¡</th>
          <th>HÃ nh Ä‘á»™ng</th>
        </tr>
      </thead>
      <tbody id="nguyenlieuTable">
        <!-- Render tá»« JS -->
      </tbody>
    </table>

    <!-- NÃºt quay láº¡i -->
    <div style="text-align:center; margin-top:30px;">
      <a href="index.html" class="btn btn-back">â† Vá» trang chá»§</a>
    </div>
  </div>

  <script>
    const API_URL = "/api/nguyenlieu";

    // Load danh sÃ¡ch
    async function loadNguyenLieu() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const table = document.getElementById("nguyenlieuTable");
      table.innerHTML = "";
      data.forEach(nl => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${nl.idnl}</td>
          <td title="${nl.tennl}">${nl.tennl}</td>
          <td>${nl.donvi}</td>
          <td>${Number(nl.gia).toLocaleString()} Ä‘</td>
          <td>
            <button class="btn btn-yellow" onclick="editNL(${nl.idnl}, '${nl.tennl}', '${nl.donvi}', ${nl.gia})">âœï¸ Sá»­a</button>
            <button class="btn btn-red" onclick="deleteNL(${nl.idnl})">ğŸ—‘ï¸ XÃ³a</button>
          </td>
        `;
        table.appendChild(row);
      });
    }

    // ThÃªm
    document.getElementById("addForm").addEventListener("submit", async e => {
      e.preventDefault();
      const tennl = document.getElementById("tennl").value;
      const donvi = document.getElementById("donvi").value;
      const gia = document.getElementById("gia").value;
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tennl, donvi, gia })
      });
      e.target.reset();
      loadNguyenLieu();
    });

    // Sá»­a
    async function editNL(idnl, oldTennl, oldDonvi, oldGia) {
      const tennl = prompt("TÃªn nguyÃªn liá»‡u:", oldTennl);
      const donvi = prompt("ÄÆ¡n vá»‹:", oldDonvi);
      const gia = prompt("ÄÆ¡n giÃ¡:", oldGia);
      if (tennl && donvi && gia) {
        await fetch(`${API_URL}/${idnl}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ tennl, donvi, gia })
        });
        loadNguyenLieu();
      }
    }

    // XÃ³a
    async function deleteNL(idnl) {
      if (confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a nguyÃªn liá»‡u nÃ y?")) {
        await fetch(`${API_URL}/${idnl}`, { method: "DELETE" });
        loadNguyenLieu();
      }
    }

    loadNguyenLieu();
  </script>
</body>
</html>
