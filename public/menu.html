<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Menu - Quáº£n lÃ½ báº¿p</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ“‹ Quáº£n lÃ½ Menu</h1>
    <!-- NÃºt quay láº¡i trang chá»§ -->
      <a href="index.html" class="btn btn-back">â† Vá» trang chá»§</a>
    </div>

    <!-- Form thÃªm mÃ³n -->
    <form id="addForm">
      <input type="text" id="tenmon" placeholder="TÃªn mÃ³n" required>
      <input type="number" id="giatien" placeholder="GiÃ¡ bÃ¡n (VNÄ)" required>
      <button type="submit" class="btn btn-green">â• ThÃªm mÃ³n</button>
    </form>

   <!-- Ã” lá»c (chá»‰ thÃªm Ä‘oáº¡n nÃ y) -->
    <div style="margin-top:12px;">
      <label for="filterInput">ğŸ” Lá»c theo tÃªn mÃ³n:</label>
      <input type="text" id="filterInput" placeholder="Nháº­p tÃªn mÃ³n Ä‘á»ƒ lá»c..." style="margin-left:8px;">
    </div>

    <!-- Báº£ng danh sÃ¡ch mÃ³n Äƒn -->
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>TÃªn mÃ³n</th>
          <th>GiÃ¡ bÃ¡n</th>
          <th>HÃ nh Ä‘á»™ng</th>
        </tr>
      </thead>
      <tbody id="menuTable">
        <!-- Render tá»« JS -->
      </tbody>
    </table>

   

  </div>

  <script>
    const API_URL = "/api/menu";

    // Load danh sÃ¡ch mÃ³n
    async function loadMenu() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const table = document.getElementById("menuTable");
      table.innerHTML = "";
      data.forEach(mon => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${mon.idmon}</td>
          <td title="${mon.tenmon}">${mon.tenmon}</td>
          <td>${Number(mon.giatien).toLocaleString()} Ä‘</td>
          <td>
            <button class="btn btn-yellow" onclick="editMon(${mon.idmon}, '${mon.tenmon}', ${mon.giatien})">âœï¸ Sá»­a</button>
            <button class="btn btn-red" onclick="deleteMon(${mon.idmon})">ğŸ—‘ï¸ XÃ³a</button>
          </td>
        `;
        table.appendChild(row);
      });

      applyFilter(); // Ã¡p dá»¥ng filter náº¿u cÃ³
    }

    // ThÃªm mÃ³n
    document.getElementById("addForm").addEventListener("submit", async e => {
      e.preventDefault();
      const tenmon = document.getElementById("tenmon").value;
      const giatien = document.getElementById("giatien").value;
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tenmon, giatien })
      });
      e.target.reset();
      loadMenu();
    });

    // Sá»­a mÃ³n
    async function editMon(idmon, oldTenmon, oldGiatien) {
      const tenmon = prompt("Nháº­p tÃªn mÃ³n:", oldTenmon);
      const giatien = prompt("Nháº­p giÃ¡ bÃ¡n:", oldGiatien);
      if (tenmon && giatien) {
        await fetch(`${API_URL}/${idmon}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ tenmon, giatien })
        });
        loadMenu();
      }
    }

    // XÃ³a mÃ³n
    async function deleteMon(idmon) {
      if (confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a mÃ³n nÃ y?")) {
        await fetch(`${API_URL}/${idmon}`, { method: "DELETE" });
        loadMenu();
      }
    }

    // HÃ m lá»c
    function applyFilter() {
      const keyword = document.getElementById("filterInput").value.toLowerCase().trim();
      const rows = document.querySelectorAll("#menuTable tr");
      rows.forEach(row => {
        const text = row.cells[1]?.textContent.toLowerCase() || "";
        row.style.display = keyword === "" || text.includes(keyword) ? "" : "none";
      });
    }

    // Gáº¯n sá»± kiá»‡n cho Ã´ lá»c
    document.getElementById("filterInput").addEventListener("input", applyFilter);

    // Gá»i ngay khi má»Ÿ trang
    loadMenu();
  </script>
</body>
</html>
