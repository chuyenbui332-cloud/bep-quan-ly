<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Menu - Quáº£n lÃ½ báº¿p</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ“‹ Quáº£n lÃ½ Menu</h1>
    <!-- NÃºt quay láº¡i trang chá»§ -->
      <a href="index.html" class="btn btn-back">â† Vá» trang chá»§</a>
    </div>

    <!-- Form thÃªm mÃ³n -->
    <form id="addForm">
      <input type="text" id="tenmon" placeholder="TÃªn mÃ³n" required>
      <input type="number" id="giatien" placeholder="GiÃ¡ bÃ¡n (VNÄ)" required>
      <button type="submit" class="btn btn-green">â• ThÃªm mÃ³n</button>
    </form>
<!-- Ã” lá»c theo tÃªn nguyÃªn liá»‡u -->
<div style="margin: 15px 0;">
  <label>Lá»c theo tÃªn nguyÃªn liá»‡u:</label>
  <input type="text" id="filter-ten" placeholder="Nháº­p tÃªn nguyÃªn liá»‡u...">
<datalist id="filter-ds"></datalist>
</div>
  
    <!-- Báº£ng danh sÃ¡ch mÃ³n Äƒn -->
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>TÃªn mÃ³n</th>
          <th>GiÃ¡ bÃ¡n</th>
          <th>HÃ nh Ä‘á»™ng</th>
        </tr>
      </thead>
      <tbody id="menuTable">
        <!-- Render tá»« JS -->
      </tbody>
    </table>

  </div>

  <script>
    const API_URL = "/api/menu";

    // Load danh sÃ¡ch mÃ³n
    async function loadMenu() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const table = document.getElementById("menuTable");
      table.innerHTML = "";
      data.forEach(mon => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${mon.idmon}</td>
          <td title="${mon.tenmon}">${mon.tenmon}</td>
          <td>${Number(mon.giatien).toLocaleString()} Ä‘</td>
          <td>
            <button class="btn btn-yellow" onclick="editMon(${mon.idmon}, '${mon.tenmon}', ${mon.giatien})">âœï¸ Sá»­a</button>
            <button class="btn btn-red" onclick="deleteMon(${mon.idmon})">ğŸ—‘ï¸ XÃ³a</button>
          </td>
        `;
        table.appendChild(row);
      });
    }

    // ThÃªm mÃ³n
    document.getElementById("addForm").addEventListener("submit", async e => {
      e.preventDefault();
      const tenmon = document.getElementById("tenmon").value;
      const giatien = document.getElementById("giatien").value;
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tenmon, giatien })
      });
      e.target.reset();
      loadMenu();
    });

    // Sá»­a mÃ³n
    async function editMon(idmon, oldTenmon, oldGiatien) {
      const tenmon = prompt("Nháº­p tÃªn mÃ³n:", oldTenmon);
      const giatien = prompt("Nháº­p giÃ¡ bÃ¡n:", oldGiatien);
      if (tenmon && giatien) {
        await fetch(`${API_URL}/${idmon}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ tenmon, giatien })
        });
        loadMenu();
      }
    }

    // XÃ³a mÃ³n
    async function deleteMon(idmon) {
      if (confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a mÃ³n nÃ y?")) {
        await fetch(`${API_URL}/${idmon}`, { method: "DELETE" });
        loadMenu();
      }
    }

    // Gá»i ngay khi má»Ÿ trang
    loadMenu();
    // Lá»c dá»¯ liá»‡u trong báº£ng theo tÃªn nguyÃªn liá»‡u
document.getElementById("filter-ten").addEventListener("input", e => {
  const keyword = e.target.value.toLowerCase().trim();
  const rows = document.querySelectorAll("#result-table tbody tr");

  rows.forEach(row => {
    const tennl = row.cells[1].innerText.toLowerCase(); // cá»™t TÃªn nguyÃªn liá»‡u
    row.style.display = tennl.includes(keyword) ? "" : "none";
  });
});
  </script>
</body>
</html>
